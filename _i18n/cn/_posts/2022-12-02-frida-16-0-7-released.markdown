---
layout: news_item
title: 'Frida 16.0.7 å‘å¸ƒ'
date: 2022-12-02 22:52:59 +0100
author: oleavr
version: 16.0.7
categories: [release]
---

è¿™æ˜¯å¿™ç¢Œçš„ä¸€å‘¨ã€‚è®©æˆ‘ä»¬æ½œå…¥ã€‚

## æ²™ç›’ç¯å¢ƒ

æœ¬å‘¨ [@hsorbo][] å’Œæˆ‘èŠ±äº†ä¸€äº›æ—¶é—´è¯•å›¾è®© Frida åœ¨æ²™ç›’ç¯å¢ƒä¸­æ›´å¥½åœ°å·¥ä½œã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯èƒ½å¤Ÿè®© Frida è¿›å…¥ iOS ä¸Šçš„ Apple SpringBoard è¿›ç¨‹ã€‚ä½†ä¸ºäº†è®©äº‹æƒ…å˜å¾—æœ‰è¶£ä¸€ç‚¹ï¼Œæˆ‘ä»¬è®¤ä¸ºæˆ‘ä»¬ä¼šä» *imagent* å¼€å§‹ï¼Œè¿™æ˜¯å¤„ç† iMessage åè®®çš„å®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒåœ¨æœ€è¿‘çš„ OS ç‰ˆæœ¬ä¸­å¾—åˆ°äº†ç›¸å½“å¤§çš„å¼ºåŒ–ï¼ŒFrida ä¸å†èƒ½å¤Ÿé™„åŠ åˆ°å®ƒã€‚

æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆåœ¨ macOS ä¸Šä»è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹å¼€å§‹ï¼Œåªæ˜¯ä¸ºäº†è®©è°ƒè¯•æ›´å®¹æ˜“ã€‚åœ¨ `/System/Library/Sandbox/Profiles/com.apple.imagent.sb` æ‰¾åˆ°å®ˆæŠ¤è¿›ç¨‹çš„æ²™ç›’é…ç½®æ–‡ä»¶åï¼Œå¾ˆéš¾é”™è¿‡ syscall ç­–ç•¥ã€‚å®ƒé»˜è®¤ç¦æ­¢æ‰€æœ‰ syscallï¼Œå¹¶ä»”ç»†å¯ç”¨ä¸€äº› syscall ç»„ï¼Œä»¥åŠå®ƒä¹Ÿéœ€è¦çš„ä¸€äº›ç‰¹å®š syscallã€‚

ç„¶åæˆ‘ä»¬å‘ç° Frida ä½¿ç”¨ pipe() syscall æ˜¯ç¬¬ä¸€ä¸ªéšœç¢ã€‚è¿™æ®µä»£ç å®é™…ä¸Šä¸åœ¨ Frida æœ¬èº«ä¸­ï¼Œè€Œæ˜¯åœ¨ GLib ä¸­ï¼Œè¿™æ˜¯ Frida ç”¨äºæ•°æ®ç»“æ„ã€è·¨å¹³å°çº¿ç¨‹åŸè¯­ã€äº‹ä»¶å¾ªç¯ç­‰çš„ä¼˜ç§€åº“ã€‚å®ƒä½¿ç”¨ pipe() æ¥å®ç°å…¶äº‹ä»¶å¾ªç¯æ‰€éœ€çš„åŸè¯­ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå®ƒä½¿ç”¨æ­¤åŸè¯­åœ¨äº‹ä»¶å¾ªç¯çš„çº¿ç¨‹é˜»å¡åœ¨ poll() é£æ ¼çš„ syscall ä¸­æ—¶å”¤é†’å®ƒã€‚

æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬æ³¨æ„åˆ° kqueue() æ˜¯æ˜ç¡®å…è®¸çš„ syscall ç»„çš„ä¸€éƒ¨åˆ†ã€‚é‰´äº Apple çš„ kqueue() æ”¯æŒåŒæ—¶è½®è¯¢æ–‡ä»¶æè¿°ç¬¦å’Œ Mach ç«¯å£ç­‰ï¼Œå®ƒå¾ˆå¯èƒ½åœ¨å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦ï¼Œå› æ­¤è¢«å¹¿æ³›çš„æ²™ç›’é…ç½®æ–‡ä»¶æ‰€å…è®¸ã€‚å®ƒä¹Ÿéå¸¸é€‚åˆæˆ‘ä»¬ï¼Œå› ä¸º EVFILT_USER æ„å‘³ç€æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å”¤é†’äº‹ä»¶å¾ªç¯çš„çº¿ç¨‹ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå®ƒä¸éœ€è¦æˆ‘ä»¬èŠ±è´¹ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚

ç»è¿‡å¤§é‡çš„å’–å•¡å’Œæœ‰è¶£çš„ç»“å¯¹ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª [patch][]ï¼Œå®ƒå°† GLib çš„äº‹ä»¶å¾ªç¯åˆ‡æ¢åˆ°æ”¯æŒå®ƒçš„ OS ä¸Šçš„ kqueue()ã€‚è¿™è®©æˆ‘ä»¬é‡åˆ°äº†ä¸‹ä¸€ä¸ªéšœç¢ï¼šFrida æ­£åœ¨ä½¿ç”¨å¥—æ¥å­— API è¿›è¡Œæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ï¼Œè¿™æ˜¯ç”¨äºæ£€æµ‹å½“å‰è¿›ç¨‹å­è¿›ç¨‹çš„ child-gating åŠŸèƒ½çš„ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œç”±äºå¼ºåŒ–çš„ç³»ç»ŸæœåŠ¡ä¸å¤ªå¯èƒ½è¢«å…è®¸åšåƒ fork() å’Œ execve() è¿™æ ·çš„äº‹æƒ…ï¼Œç®€å•åœ°é™çº§è¿™éƒ¨åˆ†åŠŸèƒ½æ˜¯å¯ä»¥çš„ã€‚æ¥ä¸‹æ¥ [tackled][] äº†è¿™ä¸ªé—®é¢˜ï¼Œç„¶å boomâ€¦â€¦ Frida ç»ˆäºèƒ½å¤Ÿé™„åŠ åˆ° *imagent* äº†ã€‚ğŸ‰ è€¶ï¼

æ¥ä¸‹æ¥æˆ‘ä»¬è½¬ç§»åˆ° iOS å¹¶åœ¨é‚£é‡Œè¯•äº†ä¸€ä¸‹ã€‚ä»¤æˆ‘ä»¬æƒŠè®¶çš„æ˜¯ï¼ŒFrida ä¸€å¼€å§‹å°±å¯ä»¥é™„åŠ åˆ° SpringBoardã€‚åæ¥æˆ‘ä»¬å°è¯•äº† *notifyd* å’Œ *profiled*ï¼Œä¹Ÿå¯ä»¥é™„åŠ åˆ°å®ƒä»¬ã€‚å³ä½¿åœ¨æœ€æ–°çš„ iOS 16 ä¸Šä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½†æ˜¯ï¼Œä»æœ‰å·¥ä½œè¦åšï¼Œå› ä¸º Frida å°šæ— æ³•é™„åŠ åˆ° iOS ä¸Šçš„ *imagent* å’Œ *WebContent*ã€‚ä¸è¿‡ï¼Œè¿™æ˜¯ä»¤äººå…´å¥‹çš„è¿›å±•ã€‚

## iOS >= 15 ä¸Šçš„æ³¨å…¥

åœ¨åšæ‰€æœ‰è¿™äº›çš„åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜è¿½è¸ªäº† iOS ä¸Šçš„ä¸€ä¸ªå´©æºƒï¼Œå…¶ä¸­ frida-server åœ¨ iOS >= 15 ä¸Šæ³¨å…¥æœŸé—´ä¼šå›  *EXC_GUARD* è€Œè¢«æ€æ­»ã€‚è¿™ä¹Ÿå·²ä¿®å¤ï¼Œæ­£å¥½èµ¶ä¸Šå‘å¸ƒï¼

## DebugSymbol API

å¦ä¸€ä¸ªä»¤äººå…´å¥‹çš„æ¶ˆæ¯æ˜¯ [@mrmacete][] æ”¹è¿›äº†æˆ‘ä»¬çš„ DebugSymbol APIï¼Œä»¥å§‹ç»ˆæä¾›å®Œæ•´è·¯å¾„è€Œä¸ä»…ä»…æ˜¯æ–‡ä»¶åã€‚è¿™æ˜¯æˆ‘ä»¬ä¸åŒå¹³å°åç«¯ä¹‹é—´é•¿æœŸå­˜åœ¨çš„ä¸ä¸€è‡´ä¹‹å¤„ã€‚ä¸æ­¤åŒæ—¶ï¼Œä»–è¿˜å…¬å¼€äº† *column*ï¼Œæ‰€ä»¥é™¤äº†è¡Œå·ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥è·å¾—å®ƒã€‚

## Interceptor.replace()ï¼Œä½†æ˜¯å¿«

æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ Interceptor ä¸­ä»¤äººå…´å¥‹çš„æ–°æ”¹è¿›ã€‚å¯¹äºé‚£äº›ä» C ä½¿ç”¨å®ƒçš„äººï¼Œç°åœ¨æœ‰ *replace_fast()* æ¥è¡¥å…… *replace()*ã€‚è¿™ä¸ªæ–°çš„å¿«é€Ÿå˜ä½“å‘å‡ºä¸€ä¸ªå†…è” hookï¼Œç›´æ¥å‘é‡åˆ°ä½ çš„æ›¿æ¢ã€‚å¦‚æœä½ æ„¿æ„ï¼Œä½ ä»ç„¶å¯ä»¥è°ƒç”¨åŸå§‹å‡½æ•°ï¼Œä½†å¿…é¡»é€šè¿‡ Interceptor ä½œä¸ºå¯é€‰è¾“å‡ºå‚æ•°æä¾›ç»™ä½ çš„å‡½æ•°æŒ‡é’ˆæ¥è°ƒç”¨å®ƒã€‚å®ƒä¹Ÿä¸èƒ½ä¸åŒä¸€ç›®æ ‡çš„ *attach()* ç»“åˆä½¿ç”¨ã€‚ä¸è¿‡å®ƒè¦å¿«å¾—å¤šï¼Œæ‰€ä»¥åœ¨éœ€è¦åœ¨çƒ­ä»£ç è·¯å¾„ä¸­ hook å‡½æ•°æ—¶ç»å¯¹å€¼å¾—æ³¨æ„ã€‚

## EOF

è¿™å°±æ˜¯è¿™æ¬¡çš„å…¨éƒ¨å†…å®¹ã€‚äº«å—å§ï¼

### å˜æ›´æ—¥å¿—

- darwin: åœ¨å¼ºåŒ–è¿›ç¨‹ä¸­ç¦ç”¨é«˜çº§åŠŸèƒ½ã€‚
- darwin: ç§»æ¤ GLib çš„ MainContext ä»¥ä½¿ç”¨ kqueue() è€Œä¸æ˜¯ poll()ã€‚
- darwin: ä¿®å¤ iOS >= 15 ä¸Šæ³¨å…¥æœŸé—´çš„ EXC_GUARDã€‚
- package-server-ios: å°† launchd plist ç§»æ¤åˆ° iOS 16ã€‚
- gadget: åŠ è½½æ—¶ä¸è¦éšè—ä¸»çº¿ç¨‹ã€‚
- debug-symbol: ç¡®ä¿è·¯å¾„æ˜¯ç»å¯¹è·¯å¾„å¹¶æ·»åŠ åˆ—å­—æ®µã€‚æ„Ÿè°¢ [@mrmacete][]ï¼
- darwin: æ·»åŠ  *query_hardened()*ã€‚
- interceptor: æ·»åŠ  *replace_fast()*ã€‚
- interceptor: å‡å°‘æ¯ä¸ªç›®æ ‡çš„å†…å­˜ä½¿ç”¨é‡ã€‚


[@hsorbo]: https://twitter.com/hsorbo
[patch]: https://github.com/frida/glib/commit/99ec1f987dfbc9b0ab45ac32dd98464cc023cd42
[tackled]: https://github.com/frida/frida-core/commit/d31a5437c583eee49da9c710d10b8c3aa89710bb
[@mrmacete]: https://twitter.com/bezjaje
